<template>
  <div class="flex flex-col lg:flex-row justify-center lg:justify-between items-center gap-4 border-b pb-4" data-testid="top-actions">
    <h1 class="text-2xl font-bold">
      <svg xmlns="http://www.w3.org/2000/svg" version="1.2" viewBox="0 0 293 147" width="50" class="inline-block mr-2 align-middle" style="transform: rotate(-25deg)">
        <path id="&lt;Path&gt;" class="s0" d="m6.12 42.37c2.8 1.83 5.66 3.69 8.89 4.53 5.57 1.46 11.5-0.33 16.47-3.13 4.96-2.8 9.29-6.57 14.13-9.57 5.81-3.59 12.35-6.04 19.14-7.15q0.06-0.01 0.13-0.02c4.2-0.68 8.75-0.77 12.45 1.35 1.35 0.77 2.55 1.83 4.02 2.36 3.93 1.45 8.75-2.54 12.4-3.77 6.93-2.34 14.53-2.74 21.74-1.24 5.96 1.23 11.06 4.32 16.77 6.33 6.58 1.39 13.3 2.37 20.02 2.49 1.91 0.04 14.33 0.83 11.98-2.93-0.74-1.2-2.3-1.59-3.7-1.87 7.6-3.68 15.65-6.49 23.92-8.34-1.08-2.15-3.91-3.26-6.16-2.42 4.39-3.4 10.07-5.15 15.68-4.81-1.42-2.13-4.05-3.42-6.6-3.24 5.02-4.36 12.48-5.83 18.89-3.71-0.35-1.36-1.22-2.58-2.39-3.39 1.64 0.17 3.23 0.79 4.56 1.77-0.71-1.33-1.93-2.39-3.36-2.91q7.9 0.11 15.8 0.22c3.33 0.04 6.82 0.13 9.75 1.73-1.24-1.94-3.05-3.53-5.15-4.52 5.03-0.7 10.41 1.33 13.72 5.2q-0.7-1.38-1.41-2.76c2.4 1.44 4.58 3.26 6.41 5.37q-1.57-2.17-3.14-4.33c8.27 1.75 16.02 5.93 22.02 11.86 2.88 2.86 3.5 5.45 2.45 9.13 2.32-0.95 4.66-1.76 7.13-2.22 1.8-0.34 3.74-0.5 5.39 0.31q-1.34 1.77-2.85 3.4 8.73-1.32 17.54-1.96c-6.08 4.02-13.45 5.6-20.63 7.11q-0.72 0.15-1.45 0.3 0.04 0.32 0.15 0.63c4.04 11.75 7.24 22.28 8.53 26.67q0-0.01 0-0.01c-0.83-2.9 3.03 5.37 3.14 8.36 0.06 1.6-0.35 3.17-0.75 4.72q-0.77 2.98-1.54 5.97c-0.19 0.71-0.44 1.52-1.12 1.83-1.35 0.63-2.98-1.22-4.32-0.57-0.47 0.24-0.76 0.74-1.25 0.95-0.45 0.19-0.97 0.1-1.45-0.06-2.59-0.83-4.43-3.16-5.58-5.6-2.87-6.12-3.96-14.11-10.13-18.05-1.32-0.85-2.8-1.42-4.21-2.1-4.18-2.03-7.86-5.07-10.61-8.79-3.3-4.45-6.45-3.77-11.31-2.1-4.03 2.11-7.62 4.17-10.07 6.09-0.46 2.58-0.45 4.87 0.52 6.54l19.45-3.47c1.34-0.04 3.13 0.48 5.01 1.11 1.47 0.63 2.76 1.67 3.98 2.9l2.88 5.04c5.2 5.43 9.79 10.49 12.7 14.55 1.29 1.42 2.24 2.95 2.76 4.61l-0.43 4.54c1.46 1.52 2.31 3.76 2.94 6.27 0.46 2.78 0.06 5.8-1.04 9-2.58 0.88-5.33-0.42-8.2-3.21-1.37-2.22-2.33-4.35-2.47-6.29l3.88-4.16c-0.5-2.3-2.15-3.71-4.5-4.56 1.04-0.51-3.7-11.13-11.18-15.71-2.44-1.48-4.97-2.5-7.63-2.96q-4.94 0.9-9.36 3.48c-4.55 2.68-8.88 3.15-13.65 4.9 2.23-2.57 3.89-5.56 4.69-8.86-1.65 6.74-13.23 9.47-8.22 15.49 2.05 2.48 7.29 3.93 9.96 6.1 2.68 2.18 5.02 4.7 7 7.52 1.98 2.94 2.91 5.95 2.61 9.05-1.79 4.44-7.31 13.13-12.65 21.62-2.18 2.11-5.1 3.54-8.46 4.55-1.82 1.4-3.21 2.88-3.41 4.56-2.34 2.83-5.46 3.93-8.74 4.66-2.75-3.64-0.73-8.7 2.92-14.24 2.94 0.34 5.95 0.91 7.06 0.04 0.49-2.05 1.12-3.92 2.45-4.96 1.37-1.11 2.77-2.01 4.25-2.23 2.4-4.22 4.63-8.32 4.95-11.09 0-3.01-0.09-5.94-1.25-7.8-2.44-1.8-5.19-3.03-8.39-3.49l-7.83-1.47c-5.05-2.42-9.23-4.94-12.45-7.59l-9.47 1.17c-12.6 3.07-25.8 2.7-38.54 0.22-6.71-1.31-13.34-4.3-20.05-5.17-2.98-0.38-4.08 0.57-3.4-2.35 0.4-1.69 2.1-3.61 2.82-5.25 0.59-1.32 0.86-3.13 1.62-4.32-4.42 6.96-10.33 11.67-18.01 14.6-7.21 2.75-14.81 4.28-21.33 8.55l-26.11 8.62c-5.26 10.21-15.22 10.04-16.87 15.14-2.19 5.21-4.68 9.44-7.76 11.71l-6.91 5.7c-1.11 2.93-2.87 5.61-5.01 8.13l-9.43 5.7c-1.58-0.73-2.8-1.62-3.32-2.83-1.15-2.46-1.5-5.08-1.33-7.81l2.52-5.64c3.31-0.77 5.94-1.81 7-3.46 2.56 1 4.92 1.66 6.11 0.31 1.02-2.78 2.69-5.75 4.88-8.86 1.79 0.6 2.66 0.27 2.86-0.75l2.53-3.61q-2.82 0.5-5.37-0.82l-2.54 1.57c-0.64 3.19-3.88 4.99-7.71 6.47-1.27 0.42-2.35 0.06-3.31-0.8l-0.73-10.69c2.22-0.52 4.15-1.42 5.65-2.89l4.01 0.27c2.87-3.84 7.36-7.04 12.89-9.84 1.91-1.53 3.47-3.24 4.6-5.16 1.66-4.25 3.99-8.17 7.07-11.71 6.98 0.41 13.14-0.67 18.46-3.3 2.52-2.14 4.01-4.68 4.35-7.69l1.21-12.98c-0.64-2.9-0.82-5.65 0.35-7.96 2.12-4.08 5.62-7.37 10.04-10.16-5.66-2.53-12.2-0.69-16.9 2.88-2.4 1.83-4.43 4.06-6.29 6.44 1.38-2.31 2.52-4.75 3.34-7.31-6.01 7.27-12.39 14.81-21.2 18.37 3.9-2.49 7.39-5.59 10.31-9.15q-7.01 4.01-14.02 8.01 7.25-5.39 14.51-10.77c-4.65 2.15-8.45 5.78-13.04 8.07-7.51 3.75-16.98 3.48-24.37-0.69 3.85 0.49 7.85-0.44 11.03-2.58-5.97 0.6-12.13-0.53-17.53-3.21-3.92-1.95-7.78-5.35-7.8-9.66q3 1.97 6 3.94z"/>
      </svg>
      Horse Racing Game
    </h1>
    <div class="flex gap-4 flex-wrap">
      <BaseButton
        @click="toggleHorseList"
        class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"
      data-testid="btn-toggle-horses">
        {{ showHorseList ? 'ğŸ´ Hide Horses' : 'ğŸ´ Show Horses' }}
      </BaseButton>
      <BaseButton
        @click="regenerateHorses"
        class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors"
        data-testid="btn-regenerate-horses">
        ğŸ´ Re-generate Horses
      </BaseButton>
      <BaseButton
        @click="generateProgram"
        :class="cn(
          'px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600',
          programs.length === 0 ? 'animate-bounce' : ''
        )"
        data-testid="btn-generate-program">
        {{ programs.length === 0 ? 'Generate Program' : 'Re-generate Program' }}
      </BaseButton>
      <BaseButton
        @click="startAllRaces"
        :disabled="programs.length === 0 || isRacing"
        :class="cn(
          'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed',
          !(programs.length === 0 || isRacing) ? 'animate-bounce' : ''
        )"
        data-testid="btn-start-all">
        Start All Races
      </BaseButton>
      <BaseButton
        v-if="isRacing"
        @click="togglePauseRaces"
        :class="cn(
          'px-4 py-2 text-white rounded transition-colors',
          isPaused ? 'bg-green-600 hover:bg-green-700 animate-bounce' : 'bg-yellow-600 hover:bg-yellow-700'
        )"
        data-testid="btn-toggle-pause">
        {{ isPaused ? 'â–¶ï¸ Resume' : 'â¸ï¸ Pause' }}
      </BaseButton>
    </div>
  </div>
</template>

<script setup lang="ts">
import { cn } from '@/utils'
import { computed } from 'vue'
import { useStore } from 'vuex'

interface Props {
  showHorseList?: boolean
}

const props = defineProps<Props>()

const emit = defineEmits<{
  toggleHorseList: []
}>()

const store = useStore()

const programs = computed(() => store.getters['gameStates/allPrograms'])
const isRacing = computed(() => store.getters['gameStates/isRacing'])
const isPaused = computed(() => store.getters['gameStates/isPaused'])

const regenerateHorses = () => {
  if (!props.showHorseList) {
    toggleHorseList()
  }
  store.dispatch('gameStates/regenerateHorses', 20)
  if (programs.value.length) {
    generateProgram()
    resetAllRaces()
  }
}

const startAllRaces = () => {
  store.dispatch('gameStates/startAllRaces')
}

const resetAllRaces = () => {
  store.dispatch('gameStates/resetAllRaces')
}

const togglePauseRaces = () => {
  store.dispatch('gameStates/togglePauseRaces')
}

const generateProgram = () => {
  resetAllRaces()
  store.dispatch('gameStates/generateProgram', 6)
}

const toggleHorseList = () => {
  emit('toggleHorseList')
}

</script>

<style scoped>

</style>
